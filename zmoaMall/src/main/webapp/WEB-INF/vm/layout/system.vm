<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8">



    <!-- 导入jquery核心类库 -->
    <script type="text/javascript"
            src="../../js/jquery-1.8.3.js"></script>
    <!-- 导入easyui类库 -->
    <link id="easyuiTheme" rel="stylesheet" type="text/css"
          href="../../js/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css"
          href="../../js/easyui/themes/icon.css">
    <link rel="stylesheet" type="text/css"
          href="../../css/default.css">
    <script type="text/javascript"
            src="../../js/easyui/jquery.easyui.min.js"></script>
    <!-- 导入ztree类库 -->
    <link rel="stylesheet"
          href="../../js/ztree/zTreeStyle.css"
          type="text/css" />
    <script
            src="../../js/ztree/jquery.ztree.all-3.5.js"
            type="text/javascript"></script>
    <script
            src="../../js/easyui/locale/easyui-lang-zh_CN.js"
            type="text/javascript"></script>
    <script
            src="../../layer/layer.js"
            type="text/javascript"></script>

    <link href="../../css/sys.css" type="text/css" rel="stylesheet" />

    <link href="../../layer/mobile/need/layer.css" type="text/css" rel="stylesheet" />

    <script type="text/javascript">
       $(function(){
           //jQuery("#tianjia").window('open');
           /*jQuery('#tianjia').dialog({
                 modal:true
             });*/
          /* var nodeName=jQuery ("#nodeName").val() ;
           alert(nodeName);*/
           var pId;

            var setting = {
                view : {
                    expandSpeed : "",
                    addHoverDom : addHoverDom,
                    removeHoverDom : removeHoverDom,
                    selectedMulti : false
                },
                edit : {
                    enable : true

                 },
                data : {
                    simpleData : {
                        enable : true
                    }
                },
                callback : {
                    onClick:onClick,
                    beforeRemove : beforeRemove,
                   // beforeRename : beforeRename,
                    beforeEditName:beforeEditName,
                }
            };



         function beforeEditName(treeId, treeNode) {
             jQuery.ajax({
                 url : '/systemCode/MenuList.action',
                 type : 'POST',
                 dataType : 'text',
                 async: 'true',
                 success : function(data) {

                     var zNodes = eval("(" + data + ")");

                     jQuery.fn.zTree.init($("#treeMenu"), setting, zNodes);
                 },
                 error : function(msg) {
                     alert('菜单加载异常!');
                 }
             });

            var id =treeNode.id;
            var name=treeNode.name;
            var code=treeNode.code;

            var nodeId=jQuery ("#nodeXGId").val(id) ;
            var nodeName=jQuery ("#nodeXGName").val(name) ;
            var nodeCode=jQuery ("#nodeXGCode").val(code) ;

            //jQuery("#xiugai").window('open');

             jQuery('#xiugai').dialog({

                 modal:true,

             });

           /*jQuery("#xgSubmit").click(function(){
                var btn = $("#addBtn_" + treeNode.tId);
                var xgName=jQuery ("#nodeXGName").val() ;
                var xgCode=jQuery ("#nodeXGCode").val() ;
                if(xgName == ""){
                    alert("请输入节点名称");
                    return;
                }else if(xgCode == ""){
                    alert("请输入节点编码");
                    return;
                }else{
                    jQuery("#xiugai").window('close');
                    var param = "&id=" + id + "&name=" + xgName+"&code="+xgCode;
                    var zTree = jQuery.fn.zTree.getZTreeObj("treeMenu");
                    jQuery.post(
                            encodeURI(encodeURI("/systemCode/UpdateMenu.action?"
                            + param)), function (data) {
                                jQuery.ajax({
                                    url : '/systemCode/MenuList.action',
                                    type : 'POST',
                                    dataType : 'text',
                                    async: 'true',
                                    success : function(data) {

                                        var zNodes = eval("(" + data + ")");

                                        jQuery.fn.zTree.init($("#treeMenu"), setting, zNodes);
                                    },
                                    error : function(msg) {
                                        alert('菜单加载异常!');
                                    }
                                });


                            });
                }
             })*/


         }

           jQuery("#xgSubmit").click(function(){



               var xgId =jQuery ("#nodeXGId").val() ;
               var xgName=jQuery ("#nodeXGName").val() ;
               var xgCode=jQuery ("#nodeXGCode").val() ;
               if(xgName == ""){
                   alert("请输入节点名称");
                   return;
               }else if(xgCode == ""){
                   alert("请输入节点编码");
                   return;
               }else{
                   jQuery("#xiugai").window('close');
                   var param = "&id=" + xgId + "&name=" + xgName+"&code="+xgCode;
                   var zTree = jQuery.fn.zTree.getZTreeObj("treeMenu");
                   jQuery.post(
                           encodeURI(encodeURI("/systemCode/UpdateMenu.action?"
                           + param)), function (data) {
                               jQuery.ajax({
                                   url : '/systemCode/MenuList.action',
                                   type : 'POST',
                                   dataType : 'text',
                                   async: 'true',
                                   success : function(data) {

                                       var zNodes = eval("(" + data + ")");

                                       jQuery.fn.zTree.init($("#treeMenu"), setting, zNodes);
                                   },
                                   error : function(msg) {
                                       alert('菜单加载异常!');
                                   }
                               });


                           });
               }
           })












        function addHoverDom(treeId, treeNode) {

               var sObj = $("#" + treeNode.tId + "_span");
               if (treeNode.editNameFlag || $("#addBtn_" + treeNode.tId).length > 0)
                   return;
               var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
                       + "' title='add node' onfocus='this.blur();'></span>";
               sObj.after(addStr);
               var btn = $("#addBtn_" + treeNode.tId);

              /* if (btn)*/
                   btn.bind("click", function() {
                        pId=treeNode.id;
                       /*jQuery("#tianjia").window('open');*/
                       jQuery('#tianjia').dialog({
                           modal:true
                       });
                      /* jQuery("#submit").click(function(){
                           var nodeName=jQuery ("#nodeName").val() ;

                           var nodeCode=jQuery ("#nodeCode").val() ;
                           if(nodeName == ""){
                               alert("请输入节点名称");
                               return;
                           }else if(nodeCode == ""){
                               alert("请输入节点编码");
                               return;
                           }else{
                               jQuery("#tianjia").window('close')

                               var param = "&pId=" + treeNode.id + "&name=" + nodeName+"&code="+nodeCode;
                               *//* var zTree = jQuery.fn.zTree.getZTreeObj("treeMenu");*//*
                               jQuery.post(
                                       encodeURI(encodeURI("/systemCode/AddMenu.action?"
                                       + param)), function (data) {
                                           *//*if (jQuery.trim(data) != null) {
                                               var treenode = jQuery.trim(data);
                                               zTree.addNodes(treeNode, {
                                                   pId: treeNode.id,
                                                   name: nodeName,
                                                   code:nodeCode
                                               }, true);
                                           }*//*
                                           // 基本功能菜单加载
                                           jQuery.ajax({
                                               url : '/systemCode/MenuList.action',
                                               type : 'POST',
                                               dataType : 'text',
                                               async: 'true',
                                               success : function(data) {

                                                   var zNodes = eval("(" + data + ")");

                                                   jQuery.fn.zTree.init($("#treeMenu"), setting, zNodes);

                                               },
                                               error : function(msg) {
                                                   alert('菜单加载异常!');
                                               }
                                           });

                                       });

                           }

                       });*/
                   });


           };


           jQuery("#submit").click(function(){
               var nodeName=jQuery ("#nodeName").val() ;

               var nodeCode=jQuery ("#nodeCode").val() ;
               if(nodeName == ""){
                   alert("请输入节点名称");
                   return;
               }else if(nodeCode == ""){
                   alert("请输入节点编码");
                   return;
               }else{
                   jQuery("#tianjia").window('close')

                   var param = "&pId=" + pId + "&name=" + nodeName+"&code="+nodeCode;
                   /* var zTree = jQuery.fn.zTree.getZTreeObj("treeMenu");*/
                   jQuery.post(
                           encodeURI(encodeURI("/systemCode/AddMenu.action?"
                           + param)), function (data) {

                               // 基本功能菜单加载
                               jQuery.ajax({
                                   url : '/systemCode/MenuList.action',
                                   type : 'POST',
                                   dataType : 'text',
                                   async: 'true',
                                   success : function(data) {

                                       var zNodes = eval("(" + data + ")");

                                       jQuery.fn.zTree.init($("#treeMenu"), setting, zNodes);

                                   },
                                   error : function(msg) {
                                       alert('菜单加载异常!');
                                   }
                               });

                           });

               }

           });






           function removeHoverDom(treeId, treeNode) {
               jQuery("#addBtn_" + treeNode.tId).unbind().remove();
           };

           function beforeRename(treeId, treeNode, newName) {

               if (newName.length == 0) {
                   alert("节点名称不能为空.");
                   return false;
               }
               var param = "id=" + treeNode.id + "&name=" + newName;
               jQuery.post(encodeURI(encodeURI("/systemCode/UpdateMenu.action?"
               + param)));
               return true;
           }

          function beforeRemove(treeId, treeNode) {
               if (confirm("确认删除节点--" + treeNode.name + "--吗?")) {
                   var id = "id=" + treeNode.id;
                   jQuery.ajax({
                       url : '/systemCode/DeleteMenu.action?'+id,
                       type : 'POST',
                       dataType : 'text',
                       async: 'true',
                       success : function(data) {


                       },
                       error : function(msg) {
                           alert('菜单删除异常!');
                       }
                   });

               } else {
                   return false;
               }
           }
            // 基本功能菜单加载
            jQuery.ajax({
                url : '/systemCode/MenuList.action',
                type : 'POST',
                dataType : 'text',
                async: 'true',
                success : function(data) {

                    var zNodes = eval("(" + data + ")");

                    jQuery.fn.zTree.init($("#treeMenu"), setting, zNodes);

                },
                error : function(msg) {
                    alert('菜单加载异常!');
                }
            });



        })
       function onClick(event, treeId, treeNode, clickFlag) {
           // 判断树菜单节点是否含有 page属性
           if (treeNode.code!=undefined && treeNode.code!= "" &&treeNode.pId!=null) {


               var content = '<div style="width:100%;height:100%;overflow:hidden;">'
                       + '<iframe src="'
##                       + '/itemSystemCode/itemListLimit.action?fid='
                       + treeNode.url + '?fid='
                       +treeNode.id
                       +'&currentPage=1'
                       + '" scrolling="auto" style="width:100%;height:100%;border:0;" ></iframe></div>';
               if ($("#tabs").tabs('exists', treeNode.name)) {// 判断tab是否存在
                   $('#tabs').tabs('select', treeNode.name); // 切换tab
                   var tab = $('#tabs').tabs('getSelected');
                   $('#tabs').tabs('update', {
                       tab: tab,
                       options: {
                           title: treeNode.name,
                           content: content
                       }
                   });
               } else {
                   // 开启一个新的tab页面
                   $('#tabs').tabs('add', {
                       title : treeNode.name,
                       content : content,
                       closable : true
                   });
               }
           }
       }



    </script>
 <body>
<body class="easyui-layout">

    <div data-options="region:'west',split:true,title:'菜单导航'"
         style="width:200px">
        <div class="easyui-accordion" fit="true" border="false">
            <div title="基本功能" data-options="iconCls:'icon-mini-add'" style="overflow:auto">
                <ul id="treeMenu" class="ztree"></ul>
            </div>
        </div>
    </div>
    <div data-options="region:'center'">
        <div id="tabs" fit="true" class="easyui-tabs" border="false">
            <div title="消息中心" id="subWarp"
                 style="width:100%;height:100%;overflow:hidden">
                <iframe src=""style="width:100%;height:100%;border:0;"></iframe>
            </div>
        </div>
    </div>




   #* 弹出框的内容*#
   #* <div id="tianjia" class="easyui-window" closed="true" collapsible="false" minimizable="false" maximizable="false"
         resizable="false" title="码表对象"  style="width: 300px; height: 200px; padding: 5px;">
        <h1 align="center">添加数据</h1>


            <table>
                <tr>
                    <td>节点名称：</td>
                    <td>
                        <input class="easyui-validatebox"
                               size="15" validType="integer" maxlength="12" id="nodeName" name="name"  type="text" >

                    </td>
                </tr>
                <tr>
                    <td>节点编码：</td>
                    <td>
                        <input class="easyui-validatebox"
                               size="15" validType="integer" maxlength="12" id="nodeCode" name="code"  type="text" >

                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="submit" id="submit" value="提交"  />
                    </td>

                </tr>
            </table>
    </div>*#
   #*  *##* 弹出框的内容*##*
    <div id="xiugai" class="easyui-window" closed="true" collapsible="false" minimizable="false" maximizable="false"
         resizable="false" title="码表对象"  style="width: 300px; height: 200px; padding: 5px;">
        <h1 align="center">修改数据</h1>


            <table>
                <tr>
                    <td>节点名称：</td>
                    <td>
                        <input class="easyui-validatebox"
                               size="15" validType="integer" maxlength="12" id="nodeXGName" name="name"  type="text" >

                    </td>
                </tr>
                <tr>
                    <td>节点编码：</td>
                    <td>
                        <input class="easyui-validatebox"
                               size="15" validType="integer" maxlength="12" id="nodeXGCode" name="code"  type="text" >

                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="submit" id="xgSubmit" value="提交"  />
                    </td>

                </tr>
            </table>
    </div>*#
    <div id="tianjia" title="My Dialog" style="width:400px;height:200px;">
        <h1 align="center">添加数据</h1>


        <table>
            <tr>
                <td>节点名称：</td>
                <td>
                    <input class="easyui-validatebox"
                           size="15" validType="integer" maxlength="12" id="nodeName" name="name"  type="text" >

                </td>
            </tr>
            <tr>
                <td>节点编码：</td>
                <td>
                    <input class="easyui-validatebox"
                           size="15" validType="integer" maxlength="12" id="nodeCode" name="code"  type="text" >

                </td>
            </tr>
            <tr>
                <td>
                    <input type="submit" id="submit" value="提交"  />
                </td>
            </tr>
        </table>
    </div>
    <div id="xiugai" title="My Dialog" style="width:400px;height:200px;">
        <h1 align="center">修改数据</h1>


        <input type="hidden" id="nodeXGId" name="id">
        <table>
            <tr>
                <td>节点名称：</td>
                <td>
                    <input class="easyui-validatebox"
                           size="15" validType="integer" maxlength="12" id="nodeXGName" name="name"  type="text" >

                </td>
            </tr>
            <tr>
                <td>节点编码：</td>
                <td>
                    <input class="easyui-validatebox"
                           size="15" validType="integer" maxlength="12" id="nodeXGCode" name="code"  type="text" >

                </td>
            </tr>
            <tr>
                <td>
                    <input type="submit" id="xgSubmit" value="提交"  />
                </td>

            </tr>
        </table>
    </div>

    <div id="dd" title="My Dialog" style="width:400px;height:200px;">
        Dialog Content.
    </div>


</body>
</html>

