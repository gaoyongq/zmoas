#set($layout = "layout/empty.vm")
<html>
    <head>
        <!-- 导入jquery核心类库 -->
        <script type="text/javascript"
                src="../../js/jquery-1.8.3.js"></script>
        <!-- 导入easyui类库 -->
       <link id="easyuiTheme" rel="stylesheet" type="text/css"
              href="../../js/easyui/themes/default/easyui.css">
##        <link rel="stylesheet" type="text/css"
##              href="../../js/easyui/themes/icon.css">
##        <link rel="stylesheet" type="text/css"
##              href="../../css/default.css">
        <script type="text/javascript"
                src="../../js/easyui/jquery.easyui.min.js"></script>
        <link rel="stylesheet" href="../../css/zmoaStyle.css">
        <link rel="stylesheet" href="../../css/Font-Awesome-3.2.1/css/font-awesome.css">
        <script src="../../js/jquery.jqprint-0.3.js"></script>
        <script>
            $(function(){
                var currentPage = "1";
                var totalPages;
                selData();
                function selData(){
                    var distributionCode = $("#distributionCode").val();
                    var number = $("#number").val();
                    jQuery.post("/business/selectDistributionAllConsent.action",{"currentPage":currentPage,"distributionCode":distributionCode,"number":number},function(data){

                        if(data.resultDistribution==null){
                            $("#mytbody").html("<tr><td colspan='11' algin='center'>查无结果</td></tr>");
                        }else {

                            var resultData = "";
                            for (var j = 0,i=1; j < data.resultDistribution.length; j++,i++) {
                                //alert(data.resultPurchaseItems[j].orderCode)
                                resultData += "<tr><td><input type='checkbox' attr='check' class='skuattr' name='purchaseCheck' id='"+data.resultDistribution[j].distributionCode+"roduct'value='"+data.resultDistribution[j].distributionCode+"' /></td>";
                                resultData += "<td>" + i + "</td>";
                                resultData += "<td>" + data.resultDistribution[j].distributionCode + "</td>";
                                //resultData += "<td> <label  title='"+data.resultPurchaseItems[j].productName+"' style='cursor: pointer;'>" + cutstr(data.resultPurchaseItems[j].productName,10) + "</td>";
                                resultData += "<td>" + data.resultDistribution[j].smallgroup + "</td>";
                                resultData += "<td>" + data.resultDistribution[j].person + "</td>";
                                resultData += "<td>" + data.resultDistribution[j].number + "</td>";
                                resultData += "<td>" + data.resultDistribution[j].allOrderNumber + "</td>";
                                resultData += "<td>" + data.resultDistribution[j].allRealNumber + "</td>";
                                resultData += "<td>" + data.resultDistribution[j].allRealWeigth + "</td>";
                                resultData += "<td>" + data.resultDistribution[j].startTime+"</td>";
                                resultData += "<td>" + data.resultDistribution[j].endTime+ "</td>";
                                resultData += "<td>" + data.resultDistribution[j].money+ "</td>";
                                resultData += "<td>" + data.resultDistribution[j].truckFinishTime+ "</td>";
//                                resultData += "<td><input type=submit value=详情 onclick=see(distributionCode='"+ data.resultDistribution[j].distributionCode +"')></td><tr>";
                                resultData += "<td> <a class='button border-blue' onclick=see(distributionCode='"+ data.resultDistribution[j].distributionCode +"')><span class='icon-file-alt'>详情</span></a></td><tr>";
                            }
                            $("#mytbody").html(resultData);
                            currentPage = data.currentPage;
                            totalPages=data.totalPages;
                            $("#page").html("" + currentPage + " / " + data.totalPages + "");

                        }
                    });
                }
//复选打印按钮
                $("#print").click(function(){
                    var distributionCodes ='';
                    $("input[attr='check']").each(function(i,v){
                        if($(v).is(":checked")){
                            if(distributionCodes){
                                distributionCodes+=',';
                            }
                            distributionCodes=distributionCodes+$(v).val();
                        }
                    });
                    if(!distributionCodes){
                        alert("你没选中任何记录");
                        return false;
                    }
                    jQuery.post("/print/logistics.action",{"distributionCodes":distributionCodes},function(data){
                        for(var i=0;i<data.length;i++){
                            var str="";
                            str+="<h2 align='center'><font size='5px'>兆美商城物流配送费用表</font></h2><br>"
                            str+="<table  border='1' cellspacing='0' cellpadding='0' width='100%'><tr><td>小组</td><td>"+data[i].distribution.smallgroup+"</td>"
                            str+="<td>配送人员</td><td colspan='2'>"+data[i].distribution.person+"</td>"
                            str+="<td>车号</td><td>"+data[i].distribution.number+"</td>"
                            str+="<td>日期</td><td colspan='4'><pre>起：  月   日   时        止：  月   日   时</pre></td><tr>"
                            str+="<tr><td>序号</td><td>订单编号</td><td>货物种类</td><td>订单数量</td><td>实际数量</td><td>重量</td>"
                            str+="<td colspan='2'>收货地址</td><td>电话</td><td>公里数</td><td>油耗/元/km</td><td>备注</td>"
                            for(var j=0;j<data[i].distributionSon.length;j++){
                                str+="<tr><td>"+(j+1)+"</td>"
                                str+="<td>"+data[i].distributionSon[j].orderCode+"</td>"
                                str+="<td>"+data[i].distributionSon[j].kind+"</td>"
                                str+="<td>"+data[i].distributionSon[j].orderNumber+"</td>"
                                str+="<td>"+data[i].distributionSon[j].practicalNumber+"</td>"
                                str+="<td>"+data[i].distributionSon[j].weight+"</td>"
                                str+="<td colspan='2'>"+data[i].distributionSon[j].address+"</td>"
                                str+="<td>"+data[i].distributionSon[j].phone+"</td>"
                                str+="<td>"+data[i].distributionSon[j].kilometre+"</td>"
                                str+="<td>"+data[i].distributionSon[j].consume+"</td>"
                                str+="<td>"+data[i].distributionSon[j].remark+"</td></tr>"
                            }
                            str+="<tr><td>合计</td><td></td><td></td><td>"+data[i].distribution.allOrderNumber+"</td>"
                            str+="<td>"+data[i].distribution.allRealNumber+"</td>"
                            str+="<td>"+data[i].distribution.allRealWeigth+"</td>"
                            str+="<td>预支旅费</td><td>"+data[i].distribution.money+"</td>"
                            str+="<td>装车完毕时间</td><td colspan='3'>"+data[i].distribution.truckFinishTime+"</td></tr></table>"
                            str+="<pre>审批                                                      组长" +
                            "                                                            制表人</pre><br><br><br>"
                            $("#printShow").append(str);
                            //$("#printShow").hide();
                        }
                        $("#printShow").jqprint({});
                        //打印完成后清空div
                        $('#printShow').html("");
                    })
                    return true;

                });

                //点击查询
                $("#query").click(function(){
                    currentPage = "1";
                    selData();
                });
                //上一页
                $("#upPage").click(function(){
                    if(currentPage==1){
                        alert("当前已经是第一页")
                    }else{
                        currentPage = currentPage-1;
                        selData();
                    }
                });

                //下一页
                $("#downPage").click(function () {
                    if(currentPage==totalPages){
                        alert("已经是最后一页")
                    }else{
                        currentPage=currentPage+1;
                        selData();
                    }
                });


            });
            function see(distributionCode){

                window.location.href="/business/distributionConsentAllParticulars.action?distributionCode="+distributionCode;
            }




        </script>
    </head>
    <body>
    <div class="place">
        <span class="icon-reorder">&nbsp;位置：</span>
        <ul class="placeul">
            <li><a>审核通过</a></li>
        </ul>
    </div>
        <div id="printShow">


        </div>



        <div>
            <div class="divtbs">
                &nbsp; &nbsp; &nbsp; &nbsp;
                物流配送编号：
                <input type="text" id="distributionCode" value="">&nbsp;
                车牌号：
                <input type="text" id="number" value="">&nbsp;
                <a class="button border-yellow" id="query"><span class="icon-search">查询</span></a>&nbsp;
                <a class="button border-blue" id="print"><span class="icon-file-alt">打印</span></a>&nbsp;
##                <input type="submit" id="query" value="查询">
##                <input type="submit" id="print" value="打印">
            </div>
            <table class="table text-center">
                <thead>
                <th width="5%"></th>
                <th width="5%">序号</th>
                <th>物流配送编号</th>
                <th>小组</td>
                <th>配送人员</th>
                <th>车牌号</th>
                <th>订单总数量</th>
                <th>采购总数量</th>
                <th>采购总数量</th>
                <th>起始时间</th>
                <th>结束时间</th>
                <th>预支差旅费</th>
                <th>装车完毕时间</th>
                <th> &nbsp; &nbsp; &nbsp; &nbsp;</th>
                </thead>
                <tbody id="mytbody"></tbody>
                #*<tr>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                    <td> &nbsp; &nbsp; &nbsp; &nbsp;</td>
                </tr>*#
              #*  <tr><td colspan="11" align="right"><font id="page"></font> &nbsp;&nbsp;<a href="#" id="upPage">上一页</a>&nbsp;&nbsp;<a href="#" id="downPage">下一页</a></td></tr>*#
            </table>
            <div>
                <table width="100%">
                    <tr><td colspan="11" align="right"><font id="page"></font> &nbsp;&nbsp;<a href="#" id="upPage">上一页</a>&nbsp;&nbsp;<a href="#" id="downPage">下一页</a></td></tr>
                </table>

            </div>
     </div>


    </body>

</html>








