#set($layout = "layout/empty.vm")

<table id="self-product-dg" fit="true" border="false" class="easyui-datagrid"
       url="/business/getSelfProductList?type=${type}&id=${id}",
       toolbar="#toolbar" pagination="true"
       rownumbers="true" fitColumns="true">
    <thead>
    <tr>
        <th field="productId" width="50%">产品ID</th>
        <th field="productName" width="50%">产品名称</th>
    </tr>
    </thead>
</table>
<div id="toolbar">
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="newUser()">添加产品</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="deleteProduct()">删除产品</a>
</div>


<div id="dlg" class="easyui-dialog" style="width:400px"
     closed="true" buttons="#dlg-buttons">
    <form id="fm" method="post" novalidate style="margin:0;padding:20px 50px">
        <div style="margin-bottom:20px;font-size:14px;border-bottom:1px solid #ccc">兆美全部产品</div>
        <div style="margin-bottom:10px">
            <input name="productIds" class="easyui-combotree" style="width:100%" data-options="
            url:'/business/getZMProductCategoriesByParentId.action',
            method:'get',
            label:'商品:',
            labelPosition:'top',
            multiple:true,
            cascadeCheck:true,
            required:true
            ">

        </div>
    </form>
</div>
<div id="dlg-buttons">
    <a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="saveUser()" style="width:90px">Save</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')" style="width:90px">Cancel</a>
</div>

<script type="text/javascript">
    function deleteProduct() {
        var row = $('#self-product-dg').datagrid('getSelected');
        if (row){
            jQuery.messager.confirm('操作提示','你确定要删除吗?',function(r){
                if (r){
                    jQuery.ajax({
                        url: '/business/deleteSelfProduct',
                        type: 'post',
                        data: {type:'${type}', id:'${id}', productId:row.productId},
                        dataType: 'json',
                        success: function(data) {
                            console.log(data);
                            $('#self-product-dg').datagrid('reload');
                        },
                        error: function(data) {
                            console.log(data);
                        }
                    });
                }
            });
        }
    }

    function newUser(){
        $('#dlg').dialog('open').dialog('center').dialog('setTitle','New User');
        $('#fm').form('clear');
        url = 'save_user.php';
    }

    function saveUser(){
        $('#fm').form('submit',{
            url: '/business/saveSelfProduct',
            queryParams: {type:'${type}', id:'${id}'},
            onSubmit: function(){
                return $(this).form('validate');
            },
            success: function(result){
                var result = eval('('+result+')');
                console.log(result);
            }
        });
    }
</script>


