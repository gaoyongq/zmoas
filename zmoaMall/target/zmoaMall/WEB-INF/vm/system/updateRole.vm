#set($layout = "layout/empty.vm")
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- 导入jquery核心类库 -->
    <script type="text/javascript"
            src="../../js/jquery-1.8.3.js"></script>
    <link rel="stylesheet" href="../../css/zmoaStyle.css">
    <link rel="stylesheet" href="../../css/Font-Awesome-3.2.1/css/font-awesome.css">
    <!-- 导入ztree类库 -->
    <link rel="stylesheet"
          href="../../js/ztree/zTreeStyle.css"
          type="text/css" />
    <script
            src="../../js/ztree/jquery.ztree.all-3.5.js"
            type="text/javascript"></script>
    <style>
        .btn{
            border:solid 1px #ddd;
            background:transparent;
            border-radius:4px;
            font-size:14px;
            padding:6px 10px;
            margin:0;
            display:inline-block;
            line-height:20px;
            cursor: pointer;
        }
        .btn.border-green{color:#5d8;border-color:#5d8;text-decoration:none;}
        .btn.border-green:hover,.btn.border-green:focus{color:#fff;border-color:#5d8;background-color:#5d8;text-decoration:none;}
    </style>
    <script type="text/javascript">

        $(function(){
            var setting = {
                data : {
                    simpleData : {
                        enable : true
                    }
                },
                check:{
                    enable:true,
                    chkStyle:'checkbox',

                }
            };
            //获得岗位ID
            var roleid = $("#id").val();
            // 基本功能菜单加载
            jQuery.ajax({
                url : '/role/updatePrivilegeRole.action',
                type : 'POST',
                data: {id:roleid},
                dataType : 'text',
                async: 'true',
                success : function(data) {
                    var zNodes = eval("(" + data + ")");

                    jQuery.fn.zTree.init($("#treeMenu"), setting, zNodes);
                },
                error : function(msg) {
                    alert('权限加载异常!');
                }
            });

            $("#edit").click(function(){
                var treeObj=jQuery.fn.zTree.getZTreeObj("treeMenu"),
                        nodes=treeObj.getCheckedNodes(true),
                        id="";
                for(var i=0;i<nodes.length;i++){
                    id+=nodes[i].id + ",";
                }
                jQuery.ajax({
                    url : '/role/PrivilegeRole.action',
                    type : 'POST',
                    data: {roleId:roleid,Id:id},
                    dataType : 'text',
                    async: 'true',
                    success : function(data) {
                        if(data==1){
                            jQuery.ajax({
                                url : '/role/updatePrivilegeRole.action',
                                type : 'POST',
                                data: {id:roleid},
                                dataType : 'text',
                                async: 'true',
                                success : function(data) {
                                    var zNodes = eval("(" + data + ")");

                                    jQuery.fn.zTree.init($("#treeMenu"), setting, zNodes);
                                },
                                error : function(msg) {
                                    alert('权限加载异常!');
                                }
                            });
                        }
                        alert('权限修改成功');
                    },
                    error : function(msg) {
                        alert('权限修改失败!');
                    }
                });

            });
        })
    </script>
</head>
<body >
<div class="place">
    <span class="icon-reorder">&nbsp;位置：</span>
    <ul class="placeul">
        <li><a>修改权限</a></li>
    </ul>
</div>
<input type="hidden" class="id" id="id" name="id" value="$!id">
<div>
    <ul id="treeMenu" class="ztree"></ul>
</div>
<div>
    <a class="btn border-green icon-check" id="edit"> 提交</a>
</div>
</body>
</html>

